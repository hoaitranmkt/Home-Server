#!/bin/bash
set -e

GREEN='\033[0;32m'
NC='\033[0m'

echo -e "${GREEN}ðŸ”„ Cáº­p nháº­t há»‡ thá»‘ng...${NC}"
sudo apt update && sudo apt upgrade -y

echo -e "${GREEN}ðŸ³ CÃ i Ä‘áº·t Docker...${NC}"
# Gá»¡ docker cÅ© náº¿u cÃ³
sudo apt remove -y docker docker-engine docker.io containerd runc || true

# CÃ i Ä‘áº·t gÃ³i há»— trá»£
sudo apt install -y ca-certificates curl gnupg lsb-release

# ThÃªm GPG key chÃ­nh thá»©c cá»§a Docker
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | \
  sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

# ThÃªm Docker repo
echo \
  "deb [arch=$(dpkg --print-architecture) \
  signed-by=/etc/apt/keyrings/docker.gpg] \
  https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# Cáº­p nháº­t vÃ  cÃ i Docker
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

echo -e "${GREEN}âœ… Docker Ä‘Ã£ Ä‘Æ°á»£c cÃ i Ä‘áº·t!${NC}"

echo -e "${GREEN}ðŸ”§ KÃ­ch hoáº¡t Docker vÃ  thÃªm user hiá»‡n táº¡i vÃ o group docker...${NC}"
sudo systemctl enable docker
sudo systemctl start docker
sudo usermod -aG docker "$USER"

echo -e "${GREEN}ðŸ§© Kiá»ƒm tra Docker Compose...${NC}"
docker compose version

echo -e "${GREEN}âœ¨ HoÃ n táº¥t! HÃ£y Ä‘Äƒng xuáº¥t vÃ  Ä‘Äƒng nháº­p láº¡i Ä‘á»ƒ Ã¡p dá»¥ng group docker.${NC}"
