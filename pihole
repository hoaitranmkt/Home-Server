#!/bin/bash
set -e

GREEN='\033[0;32m'
NC='\033[0m'

echo -e "${GREEN}ðŸ“¦ Äang chuáº©n bá»‹ cÃ i Ä‘áº·t Pi-hole báº±ng Docker...${NC}"

# Cáº¥u hÃ¬nh thÆ° má»¥c
APP_DIR=~/services/pihole
mkdir -p "$APP_DIR"/{etc-pihole,etc-dnsmasq.d}

# Di chuyá»ƒn vÃ o thÆ° má»¥c
cd "$APP_DIR" || exit 1

# Táº¡o docker-compose.yml
cat > docker-compose.yml <<EOF
version: "3"

services:
  pihole:
    container_name: pihole
    image: pihole/pihole:latest
    network_mode: host
    environment:
      TZ: 'Asia/Ho_Chi_Minh'
      WEBPASSWORD: 'changeme'
    volumes:
      - ./etc-pihole:/etc/pihole
      - ./etc-dnsmasq.d:/etc/dnsmasq.d
    restart: unless-stopped
EOF

# Khá»Ÿi Ä‘á»™ng Pi-hole
echo -e "${GREEN}ðŸš€ Äang khá»Ÿi Ä‘á»™ng Pi-hole...${NC}"
docker compose up -d

# Hiá»ƒn thá»‹ IP truy cáº­p
LOCAL_IP=$(hostname -I | awk '{print $1}')
echo -e "${GREEN}âœ… Pi-hole Ä‘Ã£ cháº¡y táº¡i: http://${LOCAL_IP}/admin${NC}"
echo -e "${GREEN}ðŸ” Máº­t kháº©u máº·c Ä‘á»‹nh: changeme${NC}"
